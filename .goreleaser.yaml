version: 2

before:
  hooks:
    - go mod tidy
    - go generate ./...

builds:
  - id: "mdz"
    env:
      - CGO_ENABLED=0
    main: ./main.go
    binary: mdz

    goos:
      - linux
      - windows
      - darwin
      - freebsd

    goarch:
      - "386"
      - amd64
      - arm
      - arm64
      - ppc64

    goarm:
      - "7"

    ldflags:
      - -X 'github.com/maxwelbm/mdz/pkg/environment.ClientID={{ .Env.CLIENT_ID }}'
        -X 'github.com/maxwelbm/mdz/pkg/environment.ClientSecret={{ .Env.CLIENT_SECRET }}'
        -X 'github.com/maxwelbm/mdz/pkg/environment.URLAPIAuth={{ .Env.URL_API_AUTH }}'
        -X 'github.com/maxwelbm/mdz/pkg/environment.URLAPILedger={{ .Env.URL_API_LEDGER }}'
        -X 'github.com/maxwelbm/mdz/pkg/environment.Version={{ .Env.VERSION }}'

nfpms:
  - id: packages
    license: MIT
    maintainer: Lerian Studio <https://github.com/maxwelbm>
    package_name: mdz
    homepage: https://github.com/maxwelbm/mdz
    bindir: /usr/local/bin
    formats:
      - deb
      - rpm
      - archlinux

changelog:
  sort: asc
  filters:
    exclude:
      - "merge conflict"
      - Merge pull request
      - Merge remote-tracking branch
      - Merge branch
      - go mod tidy
  groups:
    - title: "Breaking Changes"
      regexp: "^.*breaking[(\\w)]*:+.*$"
      order: 0
    - title: "New Features"
      regexp: "^.*feat[(\\w)]*:+.*$"
      order: 10
    - title: "Improvements"
      regexp: "^.*chore[(\\w)]*:+.*$"
      order: 20
    - title: "Bug Fixes"
      regexp: "^.*fix[(\\w)]*:+.*$"
      order: 30
    - title: "Security Updates"
      regexp: '^.*?sec(\([[:word:]]+\))??!?:.+$'
      order: 40
    - title: "Documentation Updates"
      regexp: ^.*?docs(\([[:word:]]+\))??!?:.+$
      order: 50
    - title: "Tests"
      regexp: ^.*?(test(s)?(\([[:word:]]+\))?)!?:.+$
      order: 60
    - title: Other Work
      order: 999

